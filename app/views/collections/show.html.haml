- provide :body_id, "show_collection"
- provide :title, @resource.title

= render partial: "show_button_group"

%h1
  =icon_for(@resource)
  =@resource.title

%ul.nav.nav-tabs{role: "tablist"}
  %li.nav-item
    %a#metadata-tab.nav-link.active{href: "#properties-tab-content",
                                    "data-toggle": "tab",
                                    role: "tab",
                                    "aria-controls": "properties-tab-content",
                                    "aria-selected": "true"}
      %i.fa.fa-info-circle
      Properties
  %li.nav-item
    %a#unit-membership-tab.nav-link{href: "#unit-membership-tab-content",
                                    "data-toggle": "tab",
                                    role: "tab",
                                    "aria-controls": "unit-membership-tab-content",
                                    "aria-selected": "true"}
      = icon_for(Unit)
      Unit Membership
  %li.nav-item
    %a#items-tab.nav-link{href: "#items-tab-content",
                          "data-toggle": "tab",
                          role: "tab",
                          "aria-controls": "items-tab-content",
                          "aria-selected": "true"}
      = icon_for(Item)
      Items
  - if policy(@resource).edit_access?
    %li.nav-item
      %a#access-tab.nav-link{href: "#access-tab-content",
                             "data-toggle": "tab",
                             role: "tab",
                             "aria-controls": "access-tab-content",
                             "aria-selected": "true"}
        %i.fa.fa-users
        Access


.tab-content
  #properties-tab-content.tab-pane.fade.show.active{role: "tabpanel",
                                                    "aria-labelledby": "properties-tab"}
    .row
      .col-md-8
        = metadata_as_dl(@metadata_profile, @resource.elements)
      .col-md-4
        - if current_user&.effective_manager?(@resource)
          %dl
            %dt Metadata Profile
            %dd
              - if @resource.metadata_profile
                - if policy(@metadata_profile).show?
                  = link_to(@metadata_profile.name, @metadata_profile)
                - else
                  = @metadata_profile.name
              - else
                = raw("Not assigned (falling back to #{link_to(@metadata_profile.name, @metadata_profile)})")
            %dt Submission Profile
            %dd
              - if @resource.submission_profile
                - if policy(@submission_profile).show?
                  = link_to(@submission_profile.name, @submission_profile)
                - else
                  = @submission_profile.name
              - else
                = raw("Not assigned (falling back to #{link_to(@submission_profile.name, @submission_profile)})")
        %dl
          %dt Created
          %dd= @resource.created_at
          %dt Last Updated
          %dd= @resource.updated_at

  #unit-membership-tab-content.tab-pane.fade.show{role: "tabpanel",
                                                  "aria-labelledby": "unit-membership-tab"}
    - @resource.all_units.sort{ |u| u.title <=> u.title }.each do |unit|
      .media.resource-list
        .thumbnail
          = link_to(unit) do
            = icon_for(unit)
        .media-body
          %h5.mt-0
            = link_to(unit.title, unit)
            - if @resource.primary_unit_id == unit.id
              %span.badge.badge-primary PRIMARY
          %br
          %br

  #items-tab-content.tab-pane.fade.show{role: "tabpanel",
                                        "aria-labelledby": "items-tab"}
    - if @items.count.positive?
      = form_tag(collection_path(@resource), method: :get, class: "filter") do
        .row.justify-content-between
          .col-4
            .input-group.mb-3.filter-field
              = hidden_field_tag("fq[]", "#{Item::IndexFields::COLLECTION_TITLES}:#{@resource.title}")
              = filter_field(icon: "fa fa-filter", submit_text: "Filter")
          .col-4
            .input-group
              = sort_menu(MetadataProfile.default)

      = render partial: "items/listing"
    - else
      This collection does not contain any items.

  - if policy(@resource).edit_access?
    #access-tab-content.tab-pane.fade.show{role: "tabpanel",
                                           "aria-labelledby": "access-tab"}
      %h3 Unit Administrators
      - admins = @resource.all_unit_administrators
      - if admins.any?
        %ul
          - admins.each do |user|
            %li= link_to(user.name, "mailto:#{user.email}")
      - else
        None
      %h3 Managers
      - if @resource.managing_users.any?
        %ul
          - @resource.managing_users.each do |user|
            %li= link_to(user.name, "mailto:#{user.email}")
      - else
        None
      %h3 Submitters
      - if @resource.submitters.any?
        %ul
          - @resource.submitting_users.each do |user|
            %li= link_to(user.name, "mailto:#{user.email}")
      - else
        None

= render partial: "shared/ajax_modal",
         locals: { id: "edit-collection-properties-modal",
                   title: "Edit Properties" }
= render partial: "shared/ajax_modal",
         locals: { id: "edit-collection-access-modal",
                   title: "Edit Access" }
= render partial: "shared/ajax_modal",
         locals: { id: "edit-collection-membership-modal",
                   title: "Change Unit Membership" }
