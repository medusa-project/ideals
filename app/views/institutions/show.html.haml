- provide :body_id, "show_institution"
- provide :title, @institution.name

= hidden_field_tag :institution_id, @institution.id
= hidden_field_tag :institution_key, @institution.key

.float-end
  - if @institution.units.count == 0 && policy(@institution).destroy?
    -# Delete button
    = link_to(institution_path(@institution), class: "btn btn-danger",
                                              role: "button",
                                              method: :delete,
                                              data: { confirm: "Are you sure you want to delete this institution?" }) do
      = icon_for(:delete)
      Delete

%h1
  = icon_for(@institution)
  = @institution.name

- show_access                  = policy(@institution).show_access?
- show_authentication          = policy(@institution).show_authentication?
- show_buried_items            = policy(@institution).show_buried_items?
- show_depositing              = policy(@institution).show_depositing?
- show_element_mappings        = policy(@institution).show_element_mappings?
- show_element_namespaces      = policy(@institution).show_element_namespaces?
- show_element_registry        = policy(@institution).show_element_registry?
- show_imports                 = policy(@institution).show_imports?
- show_index_pages             = policy(@institution).show_index_pages?
- show_invitees                = policy(@institution).show_invitees?
- show_items                   = policy(@institution).show_items?
- show_metadata_profiles       = policy(@institution).show_metadata_profiles?
- show_prebuilt_searches       = policy(@institution).show_prebuilt_searches?
- show_preservation            = policy(@institution).show_preservation?
- show_private_items           = policy(@institution).show_private_items?
- show_properties              = policy(@institution).show_properties?
- show_review_submissions      = policy(@institution).show_review_submissions?
- show_settings                = policy(@institution).show_settings?
- show_statistics              = policy(@institution).show_statistics?
- show_submission_profiles     = policy(@institution).show_submission_profiles?
- show_submissions_in_progress = policy(@institution).show_submissions_in_progress?
- show_theme                   = policy(@institution).show_theme?
- show_units                   = policy(@institution).show_units?
- show_usage                   = policy(@institution).show_usage?
- show_user_groups             = policy(@institution).show_user_groups?
- show_users                   = policy(@institution).show_users?
- show_vocabularies            = policy(@institution).show_vocabularies?
- show_withdrawn_items         = policy(@institution).show_withdrawn_items?

.d-flex
  .nav.nav-pills.flex-column.me-3{role:               "tablist",
                                  "aria-orientation": "vertical"}
    - if show_properties
      %button#properties-tab.nav-link.active{"data-bs-target": "#properties-tab-content",
                                             "data-bs-toggle": "pill",
                                             role:             "tab",
                                             type:             "button",
                                             "aria-controls":  "properties-tab-content",
                                             "aria-selected":  "true"}
        = icon_for(:info)
        Properties
    - if show_settings
      %button#settings-tab.nav-link{"data-bs-target": "#settings-tab-content",
                                    "data-bs-toggle": "pill",
                                    role:             "tab",
                                    type:             "button",
                                    "aria-controls":  "settings-tab-content",
                                    "aria-selected":  "false"}
        %i.fa.fa-cog
        General Settings
    - if show_authentication
      %button#authentication-tab.nav-link{"data-bs-target": "#authentication-tab-content",
                                          "data-bs-toggle": "pill",
                                          role:             "tab",
                                          type:             "button",
                                          "aria-controls":  "authentication-tab-content",
                                          "aria-selected":  "false"}
        %i.fa.fa-lock
        Authentication
    - if show_preservation
      %button#preservation-tab.nav-link{"data-bs-target": "#preservation-tab-content",
                                        "data-bs-toggle": "pill",
                                        role:             "tab",
                                        type:             "button",
                                        "aria-controls":  "preservation-tab-content",
                                        "aria-selected":  "false"}
        %i.fa.fa-box-open
        Preservation
        - if @institution.outgoing_message_queue.blank?
          %i.fa.fa-exclamation-triangle.text-danger
    - if show_theme
      %button#theme-tab.nav-link{"data-bs-target":       "#theme-tab-content",
                                 "data-bs-toggle":       "pill",
                                 role:                   "tab",
                                 type:                   "button",
                                 "aria-controls":        "theme-tab-content",
                                 "aria-selected":        "false",
                                 "data-institution-key": @institution.key}
        %i.fa.fa-palette
        Theme
    - if show_depositing
      %button#depositing-tab.nav-link{"data-bs-target": "#depositing-tab-content",
                                    "data-bs-toggle":   "pill",
                                    role:               "tab",
                                    type:               "button",
                                    "aria-controls":    "depositing-tab-content",
                                    "aria-selected":    "false"}
        %i.fa.fa-plus
        Deposit Agreement
    - if show_review_submissions
      %button#review-submissions-tab.nav-link{"data-bs-target": "#review-submissions-tab-content",
                                              "data-bs-toggle": "pill",
                                              role:             "tab",
                                              type:             "button",
                                              "aria-controls":  "review-submissions-tab-content",
                                              "aria-selected":  "false"}
        %i.fa.fa-tasks
        Review Submissions
        - if @review_count > 0
          %span.badge.rounded-pill.text-bg-primary= @review_count
    - if show_submissions_in_progress
      %button#submissions-in-progress-tab.nav-link{"data-bs-target": "#submissions-in-progress-tab-content",
                                                   "data-bs-toggle": "pill",
                                                   role:             "tab",
                                                   type:             "button",
                                                   "aria-controls":  "submissions-in-progress-tab-content",
                                                   "aria-selected":  "false"}
        %i.fa.fa-tasks
        Submissions in Progress
        - if @submissions_in_progress_count > 0
          %span.badge.rounded-pill.text-bg-primary= @submissions_in_progress_count
    - if show_units
      %button#units-tab.nav-link{"data-bs-target": "#units-tab-content",
                                 "data-bs-toggle": "pill",
                                 role:             "tab",
                                 type:             "button",
                                 "aria-controls":  "units-tab-content",
                                 "aria-selected":  "false"}
        = icon_for(Unit)
        Units
    - if show_items
      %button#items-tab.nav-link{"data-bs-target": "#items-tab-content",
                                 "data-bs-toggle": "pill",
                                 role:             "tab",
                                 type:             "button",
                                 "aria-controls":  "items-tab-content",
                                 "aria-selected":  "false"}
        = icon_for(Item)
        Items
    - if show_element_mappings
      %button#element-mappings-tab.nav-link{"data-bs-target": "#element-mappings-tab-content",
                                            "data-bs-toggle": "pill",
                                            role:             "tab",
                                            type:             "button",
                                            "aria-controls":  "element-mappings-tab-content",
                                            "aria-selected":  "false"}
        = icon_for(RegisteredElement)
        Element Mappings
    - if show_element_namespaces
      %button#element-namespaces-tab.nav-link{"data-bs-target": "#element-namespaces-tab-content",
                                              "data-bs-toggle": "pill",
                                              role:             "tab",
                                              type:             "button",
                                              "aria-controls":  "element-namespaces-tab-content",
                                              "aria-selected":  "false"}
        %i.fa.fa-code
        Element Namespaces
    - if show_element_registry
      %button#element-registry-tab.nav-link{"data-bs-target": "#element-registry-tab-content",
                                            "data-bs-toggle": "pill",
                                            role:             "tab",
                                            type:             "button",
                                            "aria-controls":  "element-registry-tab-content",
                                            "aria-selected":  "false"}
        = icon_for(RegisteredElement)
        Element Registry
    - if show_metadata_profiles
      %button#metadata-profiles-tab.nav-link{"data-bs-target": "#metadata-profiles-tab-content",
                                             "data-bs-toggle": "pill",
                                             role:             "tab",
                                             type:             "button",
                                             "aria-controls":  "metadata-profiles-tab-content",
                                             "aria-selected":  "false"}
        = icon_for(MetadataProfile)
        Metadata Profiles
    - if show_submission_profiles
      %button#submission-profiles-tab.nav-link{"data-bs-target": "#submission-profiles-tab-content",
                                               "data-bs-toggle": "pill",
                                               role:             "tab",
                                               type:             "button",
                                               "aria-controls":  "submission-profiles-tab-content",
                                               "aria-selected":  "false"}
        = icon_for(SubmissionProfile)
        Submission Profiles
    - if show_vocabularies
      %button#vocabularies-tab.nav-link{"data-bs-target": "#vocabularies-tab-content",
                                        "data-bs-toggle": "pill",
                                        role:             "tab",
                                        type:             "button",
                                        "aria-controls":  "vocabularies-tab-content",
                                        "aria-selected":  "false"}
        = icon_for(Vocabulary)
        Vocabularies
    - if show_prebuilt_searches
      %button#prebuilt-searches-tab.nav-link{"data-bs-target": "#prebuilt-searches-tab-content",
                                             "data-bs-toggle": "pill",
                                             role:             "tab",
                                             type:             "button",
                                             "aria-controls":  "prebuilt-searches-tab-content",
                                             "aria-selected":  "false"}
        = icon_for(PrebuiltSearch)
        Prebuilt Searches
    - if show_index_pages
      %button#index-pages-tab.nav-link{"data-bs-target": "#index-pages-tab-content",
                                       "data-bs-toggle": "pill",
                                       role:             "tab",
                                       type:             "button",
                                       "aria-controls":  "index-pages-tab-content",
                                       "aria-selected":  "false"}
        = icon_for(IndexPage)
        Index Pages
    - if show_imports
      %button#imports-tab.nav-link{"data-bs-target": "#imports-tab-content",
                                   "data-bs-toggle": "pill",
                                   role:             "tab",
                                   type:             "button",
                                   "aria-controls":  "imports-tab-content",
                                   "aria-selected":  "false"}
        = icon_for(Import)
        Imports
    - if show_invitees
      %button#invitees-tab.nav-link{"data-bs-target": "#invitees-tab-content",
                                    "data-bs-toggle": "pill",
                                    role:             "tab",
                                    type:             "button",
                                    "aria-controls":  "invitees-tab-content",
                                    "aria-selected":  "false"}
        = icon_for(Invitee)
        Invitees
    - if show_users
      %button#users-tab.nav-link{"data-bs-target": "#users-tab-content",
                                 "data-bs-toggle": "pill",
                                 role:             "tab",
                                 type:             "button",
                                 "aria-controls":  "users-tab-content",
                                 "aria-selected":  "false"}
        = icon_for(User)
        Users
    - if show_user_groups
      %button#user-groups-tab.nav-link{"data-bs-target": "#user-groups-tab-content",
                                       "data-bs-toggle": "pill",
                                       role:             "tab",
                                       type:             "button",
                                       "aria-controls":  "user-groups-tab-content",
                                       "aria-selected":  "false"}
        = icon_for(UserGroup)
        User Groups
    - if show_access
      %button#access-tab.nav-link{"data-bs-target":       "#access-tab-content",
                                  "data-bs-toggle":       "pill",
                                  role:                   "tab",
                                  type:                   "button",
                                  "aria-controls":        "access-tab-content",
                                  "aria-selected":        "false",
                                  "data-institution-key": @institution.key}
        %i.fa.fa-users
        Access
    - if show_statistics
      %button#statistics-tab.nav-link{"data-bs-target":       "#statistics-tab-content",
                                      "data-bs-toggle":       "pill",
                                      role:                   "tab",
                                      type:                   "button",
                                      "aria-controls":        "statistics-tab-content",
                                      "aria-selected":        "false",
                                      "data-institution-key": @institution.key}
        %i.fa.fa-chart-bar
        Statistics
    - if show_usage
      %button#usage-tab.nav-link{"data-bs-target":       "#usage-tab-content",
                                 "data-bs-toggle":       "pill",
                                 role:                   "tab",
                                 type:                   "button",
                                 "aria-controls":        "usage-tab-content",
                                 "aria-selected":        "false",
                                 "data-institution-key": @institution.key}
        %i.fa.fa-chart-bar
        Usage

  .tab-content.w-100
    - if show_properties
      #properties-tab-content.tab-pane.fade.show.active{role:              "tabpanel",
                                                        "aria-labelledby": "properties-tab"}
        = spinner

    - if show_settings
      #settings-tab-content.tab-pane.fade{role:              "tabpanel",
                                          "aria-labelledby": "settings-tab"}
        = spinner

    - if show_authentication
      #authentication-tab-content.tab-pane.fade{role:              "tabpanel",
                                                "aria-labelledby": "authentication-tab"}
        = spinner

    - if show_element_mappings
      #element-mappings-tab-content.tab-pane.fade{role:              "tabpanel",
                                                  "aria-labelledby": "element-mappings-tab"}
        = spinner

    - if show_element_namespaces
      #element-namespaces-tab-content.tab-pane.fade{role:              "tabpanel",
                                                    "aria-labelledby": "element-namespaces-tab"}
        = spinner

    - if show_element_registry
      #element-registry-tab-content.tab-pane.fade{role:              "tabpanel",
                                                  "aria-labelledby": "element-registry-tab"}
        = spinner

    - if show_metadata_profiles
      #metadata-profiles-tab-content.tab-pane.fade{role:              "tabpanel",
                                                   "aria-labelledby": "metadata-profiles-tab"}
        = spinner

    - if show_submission_profiles
      #submission-profiles-tab-content.tab-pane.fade{role:              "tabpanel",
                                                     "aria-labelledby": "submission-profiles-tab"}
        = spinner

    - if show_vocabularies
      #vocabularies-tab-content.tab-pane.fade{role:              "tabpanel",
                                              "aria-labelledby": "vocabularies-tab"}
        = spinner

    - if show_prebuilt_searches
      #prebuilt-searches-tab-content.tab-pane.fade{role:              "tabpanel",
                                                   "aria-labelledby": "prebuilt-searches-tab"}
        = spinner

    - if show_index_pages
      #index-pages-tab-content.tab-pane.fade{role:              "tabpanel",
                                             "aria-labelledby": "index-pages-tab"}
        = spinner

    - if show_preservation
      #preservation-tab-content.tab-pane.fade{role:              "tabpanel",
                                              "aria-labelledby": "preservation-tab"}
        = spinner

    - if show_theme
      #theme-tab-content.tab-pane.fade{role:              "tabpanel",
                                       "aria-labelledby": "theme-tab"}
        = spinner

    - if show_depositing
      #depositing-tab-content.tab-pane.fade{role:              "tabpanel",
                                            "aria-labelledby": "depositing-tab"}
        = spinner

    - if show_units
      #units-tab-content.tab-pane.fade{role:              "tabpanel",
                                       "aria-labelledby": "units-tab"}
        = spinner

    - if show_items
      #items-tab-content.tab-pane.fade{role:              "tabpanel",
                                       "aria-labelledby": "items-tab"}
        %nav
          #withdrawn-items-tab.nav.nav-tabs{role: "tablist"}
            %button#private-items-tab.nav-link.active{"data-bs-toggle": "tab",
                                                      "data-bs-target": "#private-items-tab-content",
                                                      type:             "button",
                                                      role:             "tab",
                                                      "aria-controls":  "private-items-tab-content",
                                                      "aria-selected":  "true"} Private Items
            %button#withdrawn-items-tab.nav-link{"data-bs-toggle": "tab",
                                                 "data-bs-target": "#withdrawn-items-tab-content",
                                                 type:             "button",
                                                 role:             "tab",
                                                 "aria-controls":  "withdrawn-items-tab-content",
                                                 "aria-selected":  "false"} Withdrawn Items
            %button#rejected-items-tab.nav-link{"data-bs-toggle": "tab",
                                                "data-bs-target": "#rejected-items-tab-content",
                                                type:             "button",
                                                role:             "tab",
                                                "aria-controls":  "rejected-items-tab-content",
                                                "aria-selected":  "false"} Rejected Items
            %button#deleted-items-tab.nav-link{"data-bs-toggle": "tab",
                                               "data-bs-target": "#deleted-items-tab-content",
                                               type:             "button",
                                               role:             "tab",
                                               "aria-controls":  "deleted-items-tab-content",
                                               "aria-selected":  "false"} Deleted Items
        .tab-content
          #private-items-tab-content.tab-pane.fade.show.active{role:              "tabpanel",
                                                               "aria-labelledby": "private-items-tab",
                                                               tabindex:          0}
            = form_tag(institution_private_items_path(@institution)) do
              .btn-group.float-end{role: "group"}
                = link_to(search_path, host: @institution.fqdn, class: "btn btn-light", role: "button", target: "_blank") do
                  %i.fas.fa-arrow-up-right-from-square
                  Public Items View
              .mb-3{style: "width: 15em;"}
                = filter_field(placeholder: "Filter")
              #private-items-results
                = spinner
          #withdrawn-items-tab-content.tab-pane.fade{role:              "tabpanel",
                                                     "aria-labelledby": "withdrawn-items-tab",
                                                     tabindex:          0}
            = form_tag(institution_withdrawn_items_path(@institution)) do
              .btn-group.float-end{role: "group"}
                = link_to(search_path, host: @institution.fqdn, class: "btn btn-light", role: "button", target: "_blank") do
                  %i.fas.fa-arrow-up-right-from-square
                  Public Items View
              .mb-3{style: "width: 15em;"}
                = filter_field(placeholder: "Filter")
              #withdrawn-items-results
                = spinner
          #rejected-items-tab-content.tab-pane.fade{role:              "tabpanel",
                                                    "aria-labelledby": "rejected-items-tab",
                                                    tabindex:          0}
            = form_tag(institution_rejected_items_path(@institution)) do
              .btn-group.float-end{role: "group"}
                = link_to(search_path, host: @institution.fqdn, class: "btn btn-light", role: "button", target: "_blank") do
                  %i.fas.fa-arrow-up-right-from-square
                  Public Items View
              .mb-3{style: "width: 15em;"}
                = filter_field(placeholder: "Filter")
              #rejected-items-results
                = spinner
          #deleted-items-tab-content.tab-pane.fade{role:              "tabpanel",
                                                   "aria-labelledby": "deleted-items-tab",
                                                   tabindex:          0}
            = form_tag(institution_buried_items_path(@institution)) do
              .btn-group.float-end{role: "group"}
                = link_to(search_path, host: @institution.fqdn, class: "btn btn-light", role: "button", target: "_blank") do
                  %i.fas.fa-arrow-up-right-from-square
                  Public Items View
              .mb-3{style: "width: 15em;"}
                = filter_field(placeholder: "Filter")
              #deleted-items-results
                = spinner

    - if show_review_submissions
      #review-submissions-tab-content.tab-pane.fade{role:              "tabpanel",
                                                    "aria-labelledby": "review-submissions-tab"}
        = spinner

    - if show_submissions_in_progress
      #submissions-in-progress-tab-content.tab-pane.fade{role:              "tabpanel",
                                                         "aria-labelledby": "submissions-in-progress-tab"}
        = spinner

    - if show_imports
      #imports-tab-content.tab-pane.fade{role:              "tabpanel",
                                         "aria-labelledby": "imports-tab"}
        = spinner

    - if show_invitees
      #invitees-tab-content.tab-pane.fade{role:              "tabpanel",
                                          "aria-labelledby": "invitees-tab"}
        = spinner

    - if show_users
      #users-tab-content.tab-pane.fade{role:              "tabpanel",
                                       "aria-labelledby": "users-tab"}
        = spinner

    - if show_user_groups
      #user-groups-tab-content.tab-pane.fade{role:              "tabpanel",
                                             "aria-labelledby": "user-groups-tab"}
        = spinner

    - if show_statistics
      #statistics-tab-content.tab-pane.fade{role:              "tabpanel",
                                            "aria-labelledby": "statistics-tab"}
        = spinner

    - if show_usage
      #usage-tab-content.tab-pane.fade{role:              "tabpanel",
                                       "aria-labelledby": "usage-tab"}
        = spinner

    - if show_access
      #access-tab-content.tab-pane.fade{role:              "tabpanel",
                                        "aria-labelledby": "access-tab"}
        = spinner

= render partial: "shared/xhr_modal",
         locals: { id: "add-unit-modal", title: "Add Unit" }
= render partial: "shared/xhr_modal",
         locals: { id: "edit-element-mappings-modal", title: "Edit Element Mappings" }
= render partial: "shared/xhr_modal",
         locals: { id: "edit-preservation-modal", title: "Edit Preservation" }
= render partial: "shared/xhr_modal",
         locals: { id: "edit-properties-modal", title: "Edit Properties" }
= render partial: "shared/xhr_modal",
         locals: { id: "edit-settings-modal", title: "Edit Settings" }
= render partial: "shared/xhr_modal",
         locals: { id: "edit-theme-modal", title: "Edit Theme" }