-# @param institution [Institution]

= form_for(institution, url: institution_settings_path(institution), remote: true) do |f|
  .error-messages
    -# populated via ajax by shared/_validation_messages.js.erb

  %h5 SAML Authentication

  .mb-3
    .form-check
      = f.check_box(:saml_auth_enabled,
                    id:    "saml-auth-enabled",
                    class: "form-check-input")
      = f.label(:saml_auth_enabled, "Enabled", class: "form-check-label")

  %hr

  %h5 SSO Federation

  .mb-3
    .form-check
      = f.radio_button(:sso_federation, Institution::SSOFederation::NONE, id: "saml", class: "form-check-input")
      %label.form-check-label{for: "saml"}
        None
    .form-check
      = f.radio_button(:sso_federation, Institution::SSOFederation::ITRUST, id: "itrust", class: "form-check-input")
      %label.form-check-label{for: "itrust"}
        = Institution::SSOFederation.label_for(Institution::SSOFederation::ITRUST)
    .form-check
      = f.radio_button(:sso_federation, Institution::SSOFederation::OPENATHENS, id: "oaf", class: "form-check-input")
      %label.form-check-label{for: "oaf"}
        = Institution::SSOFederation.label_for(Institution::SSOFederation::OPENATHENS)

  %hr

  .row
    .col-lg-6
      %h5 Service Provider
      .mb-3
        = f.label :saml_sp_entity_id, "Entity ID"
        = f.text_field :saml_sp_entity_id, class: "form-control"
      .mb-3
        = f.label :saml_sp_private_key, "Private Key"
        = f.text_area :saml_sp_private_key, rows: 10, class: "form-control"
      .mb-3
        .form-check
          = f.check_box(:saml_auto_cert_rotation,
                        class: "form-check-input")
          = f.label(:saml_auto_cert_rotation, "Rotate Certificates Automatically",
                    class: "form-check-label")
      .mb-3
        = f.label :saml_sp_public_cert, "Public Certificate"
        = f.text_area :saml_sp_public_cert, rows: 10, class: "form-control"
      .mb-3
        = f.label :saml_sp_next_public_cert, "Next Public Certificate"
        = f.text_area :saml_sp_next_public_cert, rows: 10, class: "form-control"
        %p.form-text
          = icon_for(:info)
          This certificate, which has a later expiration than the other public
          certificate, will be rotated into its place when it expires.

    .col-lg-6
      %h5 Identity Provider
      .mb-3
        = f.label :saml_idp_entity_id, "Entity ID"
        = f.text_field :saml_idp_entity_id, class: "form-control"
        %p.form-text
          = icon_for(:info)
          After changing this value, you should refresh the configuration metadata
          from the page beneath this panel.
      .mb-3
        = f.label :saml_idp_sso_binding_urn, "SSO Binding"
        = f.select(:saml_idp_sso_binding_urn,
                   options_for_select([["POST", "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"],
                                       ["Redirect", "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"]],
                                       f.object.saml_idp_sso_binding_urn),
                   {},
                   class: "form-select")
      .mb-3
        = f.label :saml_idp_sso_post_service_url, "SSO POST Service URL"
        = f.text_field :saml_idp_sso_post_service_url, class: "form-control"
      .mb-3
        = f.label :saml_idp_sso_redirect_service_url, "SSO Redirect Service URL"
        = f.text_field :saml_idp_sso_redirect_service_url, class: "form-control"
      .mb-3
        = f.label :saml_idp_signing_cert, "Signing Certificate"
        = f.text_area :saml_idp_signing_cert, rows: 10, class: "form-control"
      .mb-3
        = f.label :saml_idp_signing_cert2, "Signing Certificate 2"
        = f.text_area :saml_idp_signing_cert2, rows: 10, class: "form-control"
      .mb-3
        = f.label :saml_idp_encryption_cert, "Encryption Certificate"
        = f.text_area :saml_idp_encryption_cert, rows: 10, class: "form-control"
      .mb-3
        = f.label :saml_idp_encryption_cert2, "Encryption Certificate 2"
        = f.text_area :saml_idp_encryption_cert2, rows: 10, class: "form-control"
      .mb-3
        = f.label :saml_email_location, "Email Location"
        = f.select :saml_email_location,
                   options_for_select(Institution::SAMLEmailLocation.all.map{ |v| [Institution::SAMLEmailLocation.label_for(v), v] },
                                      f.object.saml_email_location),
                   {}, class: "form-select"
      .mb-3
        = f.label :saml_email_attribute, "Email Attribute"
        = f.text_field :saml_email_attribute, class: "form-control"
      .mb-3
        = f.label :saml_first_name_attribute, "First Name Attribute"
        = f.text_field :saml_first_name_attribute, class: "form-control"
      .mb-3
        = f.label :saml_last_name_attribute, "Last Name Attribute"
        = f.text_field :saml_last_name_attribute, class: "form-control"
        %p.form-text
          = icon_for(:info)
          If you don't have separate first and last name attributes, enter the full
          name attribute here.

  .clearfix
    .float-end
      %button.btn.btn-light{"data-bs-dismiss": "modal", type: "button"} Cancel
      = f.submit("Save Changes", class: "btn btn-primary")
